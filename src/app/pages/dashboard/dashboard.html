<div class="dashboard-container">
  <div class="dashboard-header">
    <div class="user-profile-header">
      <app-user-avatar [username]="currentUser()?.username || 'Usuario'" [clickable]="false" size="extra-large">
      </app-user-avatar>
      <div class="user-info-header">
        <h1>{{ currentUser()?.username || 'Usuario' }}</h1>
        <p>{{ currentUser()?.email }}</p>
      </div>
    </div>
  </div>

  <!-- Cards do Dashboard -->
  <div class="dashboard-grid">

    <!-- Card de Informações Pessoais -->
    <p-card class="info-card">
      <ng-template pTemplate="header">
        <div class="card-header-content">
          <i class="pi pi-user"></i>
          <span>Informações Pessoais</span>
        </div>
      </ng-template>
      <div class="user-details">
        <div class="detail-row">
          <label>ID:</label>
          <span>{{ currentUser()?.id }}</span>
        </div>
        <div class="detail-row">
          <label>Nome de Usuário:</label>
          <span>{{ currentUser()?.username || 'Não informado' }}</span>
        </div>
        <div class="detail-row">
          <label>Email:</label>
          <span>{{ currentUser()?.email || 'Não informado' }}</span>
        </div>
        <div class="detail-row">
          <label>Status da Conta:</label>
          <span class="status-active"><i class="pi pi-check-circle"></i> Ativa</span>
        </div>
      </div>

      <div class="card-actions">
        <button type="button" class="custom-header-button" (click)="onEditProfile()">
          <span>Editar Perfil</span>
        </button>

      </div>
    </p-card>

    <!-- Card de Autenticação -->
    <p-card class="auth-card">
      <ng-template pTemplate="header">
        <div class="card-header-content">
          <i class="pi pi-shield"></i>
          <span>Status de Autenticação</span>
        </div>
      </ng-template>
      <div class="auth-info">
        <div class="auth-status">
          <i class="pi pi-check-circle success-icon"></i>
          <div>
            <h3>Autenticado com Sucesso</h3>
            <p>Você está logado e pode acessar todas as funcionalidades.</p>
          </div>
        </div>

        <div class="security-features">
          <h4>Recursos de Segurança:</h4>
          <ul>
            <li><i class="pi pi-check"></i> Token de autenticação válido</li>
            <li><i class="pi pi-check"></i> Sessão segura ativa</li>
            <li><i class="pi pi-check"></i> Auth Guard funcionando</li>
            <li><i class="pi pi-check"></i> Acesso a rotas protegidas</li>
          </ul>
        </div>
      </div>
    </p-card>

    <!-- Card de Ações da Conta -->
    <p-card class="actions-card">
      <ng-template pTemplate="header">
        <div class="card-header-content">
          <i class="pi pi-cog"></i>
          <span>Gerenciar Conta</span>
        </div>
      </ng-template>
      <div class="account-actions">
        <div class="action-section">
          <h4>Navegação</h4>
          <div class="action-buttons">
            <button type="button" class="custom-header-button" (click)="navigateToMyCharacters()">
              <span style="gap: 0.5rem"> <i class="pi pi-flag"></i> Minhas Campanhas</span>
            </button>

            <button type="button" class="custom-header-button" (click)="onLegend()">
              <span style="gap: 0.5rem"> <i class="pi pi-user-plus"></i> Criar Personagem</span>
            </button>

            <button type="button" class="custom-header-button" (click)="navigateToMyCharacters()">
              <span style="gap: 0.5rem"> <i class="pi pi-user-edit"></i> Meus Personagens</span>
            </button>

            <button type="button" class="custom-header-button" (click)="onHome()">
              <span style="gap: 0.5rem"> <i class="pi pi-home"></i> Voltar ao Início</span>
            </button>
          </div>
        </div>

        <div class="action-section">
          <h4>Conta</h4>
          <div class="action-buttons">
            <button type="button" class="custom-header-button" (click)="onLogout()">
              <span style="gap: 0.5rem"> <i class="pi pi-sign-out"></i> Fazer Logout</span>
            </button>
            <button type="button" class="custom-header-button" (click)="onDeleteAccount()">
              <span style="gap: 0.5rem"> <i class="pi pi-trash"></i> Deletar Conta</span>
            </button>
          </div>
        </div>
      </div>
    </p-card>

  </div>

  <!-- Custom Edit Profile Modal -->
  <div class="custom-modal-overlay" *ngIf="isEditModalVisible()" (click)="onCancelEdit()">
    <div class="custom-modal" (click)="$event.stopPropagation()">
      <!-- Modal Header -->
      <div class="custom-modal-header">
        <div class="header-line"></div>
        <div class="header-content">
          <div class="header-icon">
            <i class="pi pi-user-edit"></i>
          </div>
          <h2 class="header-title">EDITAR PERFIL</h2>
        </div>
        <button class="close-button" (click)="onCancelEdit()">
          <i class="pi pi-times"></i>
        </button>
      </div>

      <!-- Modal Content -->
      <div class="custom-modal-content">
        <!-- User Preview -->
        <div class="user-preview-section">
          <div class="user-preview">
            <div class="preview-avatar">
              <i class="pi pi-user"></i>
            </div>
            <div class="user-info">
              <h3 class="user-name">{{ currentUser()?.username || 'Usuário' }}</h3>
              <div class="user-tag">
                <span>Perfil Ativo</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Form Section -->
        <form [formGroup]="editForm" (ngSubmit)="onSaveProfile()">
          <!-- Username Input -->
          <div class="form-input-section">
            <label for="username" class="input-label">
              <span class="label-dot"></span>
              NOME DE USUÁRIO *
            </label>
            <div class="input-container">
              <div class="input-icon">
                <i class="pi pi-user"></i>
              </div>
              <input
                id="username"
                type="text"
                formControlName="username"
                placeholder="Seu nome de usuário"
                class="custom-input"
                [class.input-error]="editForm.get('username')?.touched && editForm.get('username')?.errors"
                autocomplete="username"
              />
              <div class="input-border"></div>
            </div>
            <small class="input-help input-error-text" *ngIf="usernameErrors">
              <i class="pi pi-exclamation-triangle"></i>
              {{ usernameErrors }}
            </small>
          </div>

          <!-- Email Input -->
          <div class="form-input-section">
            <label for="email" class="input-label">
              <span class="label-dot"></span>
              EMAIL *
            </label>
            <div class="input-container">
              <div class="input-icon">
                <i class="pi pi-envelope"></i>
              </div>
              <input
                id="email"
                type="email"
                formControlName="email"
                placeholder="seu@email.com"
                class="custom-input"
                [class.input-error]="editForm.get('email')?.touched && editForm.get('email')?.errors"
                autocomplete="email"
              />
              <div class="input-border"></div>
            </div>
            <small class="input-help input-error-text" *ngIf="emailErrors">
              <i class="pi pi-exclamation-triangle"></i>
              {{ emailErrors }}
            </small>
          </div>

          <div class="form-input-section">
            <label for="password" class="input-label">
              <span class="label-dot"></span>
              NOVA SENHA (OPCIONAL)
            </label>
            <div class="input-container">
              <div class="input-icon">
                <i class="pi pi-lock"></i>
              </div>
              <input
                id="password"
                type="password"
                formControlName="password"
                placeholder="Deixe em branco para manter a atual"
                class="custom-input"
                [class.input-error]="editForm.get('password')?.touched && editForm.get('password')?.errors"
                autocomplete="new-password"
              />
              <div class="input-border"></div>
            </div>
            <small class="input-help input-error-text" *ngIf="passwordErrors">
              <i class="pi pi-exclamation-triangle"></i>
              {{ passwordErrors }}
            </small>
            <small class="input-help" *ngIf="!passwordErrors">
              <i class="pi pi-info-circle"></i>
              Mínimo 6 caracteres, deixe vazio para não alterar
            </small>
          </div>

          <!-- Modal Footer -->
          <div class="custom-modal-footer">
            <div class="footer-line"></div>
            <div class="dialog-actions">
              <button type="button" class="custom-button cancel-button" (click)="onCancelEdit()">
                <i class="pi pi-times"></i>
                <span>CANCELAR</span>
                <div class="button-shimmer"></div>
              </button>
              <button
                type="submit"
                class="custom-button save-button"
                [disabled]="!editForm.valid || isLoading()"
              >
                <i class="pi pi-check" *ngIf="!isLoading()"></i>
                <i class="pi pi-spin pi-spinner" *ngIf="isLoading()"></i>
                <span>{{ isLoading() ? 'SALVANDO...' : 'SALVAR' }}</span>
                <div class="button-shimmer" *ngIf="!isLoading()"></div>
              </button>
            </div>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Modal de Confirmação para Deletar Conta -->
  <p-confirmDialog></p-confirmDialog>

</div>
