<div class="dashboard-container">
  <!-- Header do Dashboard -->
  <div class="dashboard-header">
    <div class="user-profile-header">
      <app-user-avatar
        [username]="currentUser()?.username || 'Usuario'"
        [clickable]="false"
        size="extra-large">
      </app-user-avatar>
      <div class="user-info-header">
        <h1>{{ currentUser()?.username || 'Usuario' }}</h1>
        <p>{{ currentUser()?.email }}</p>
      </div>
    </div>
  </div>

  <!-- Cards do Dashboard -->
  <div class="dashboard-grid">

    <!-- Card de Informações Pessoais -->
    <p-card class="info-card">
      <ng-template pTemplate="header">
        <div class="card-header-content">
          <i class="pi pi-user"></i>
          <span>Informações Pessoais</span>
        </div>
      </ng-template>
      <div class="user-details">
        <div class="detail-row">
          <label>ID:</label>
          <span>{{ currentUser()?.id }}</span>
        </div>
        <div class="detail-row">
          <label>Nome de Usuário:</label>
          <span>{{ currentUser()?.username || 'Não informado' }}</span>
        </div>
        <div class="detail-row">
          <label>Email:</label>
          <span>{{ currentUser()?.email || 'Não informado' }}</span>
        </div>
        <div class="detail-row">
          <label>Status da Conta:</label>
          <span class="status-active"><i class="pi pi-check-circle"></i> Ativa</span>
        </div>
      </div>

      <div class="card-actions">
        <button
          type="button"
          class="custom-header-button"
          (click)="onEditProfile()"
        >
          <span>Editar Perfil</span>
        </button>

      </div>
    </p-card>

    <!-- Card de Autenticação -->
    <p-card class="auth-card">
      <ng-template pTemplate="header">
        <div class="card-header-content">
          <i class="pi pi-shield"></i>
          <span>Status de Autenticação</span>
        </div>
      </ng-template>
      <div class="auth-info">
        <div class="auth-status">
          <i class="pi pi-check-circle success-icon"></i>
          <div>
            <h3>Autenticado com Sucesso</h3>
            <p>Você está logado e pode acessar todas as funcionalidades.</p>
          </div>
        </div>

        <div class="security-features">
          <h4>Recursos de Segurança:</h4>
          <ul>
            <li><i class="pi pi-check"></i> Token de autenticação válido</li>
            <li><i class="pi pi-check"></i> Sessão segura ativa</li>
            <li><i class="pi pi-check"></i> Auth Guard funcionando</li>
            <li><i class="pi pi-check"></i> Acesso a rotas protegidas</li>
          </ul>
        </div>
      </div>
    </p-card>

    <!-- Card de Ações da Conta -->
    <p-card class="actions-card">
      <ng-template pTemplate="header">
        <div class="card-header-content">
          <i class="pi pi-cog"></i>
          <span>Gerenciar Conta</span>
        </div>
      </ng-template>
      <div class="account-actions">
        <div class="action-section">
          <h4>Navegação</h4>
          <div class="action-buttons">
            <button
          type="button"
          class="custom-header-button"
          (click)="navigateToMyCharacters()"
        >
          <span style="gap: 0.5rem" >  <i class="pi pi-user-edit"></i>  Meus Personagens</span>
        </button>
        <button
          type="button"
          class="custom-header-button"
          (click)="onLegend()"
        >
          <span style="gap: 0.5rem">  <i class="pi pi-user-plus"></i>  Criar Personagem</span>
        </button>
            <button
              type="button"
              class="custom-header-button"
              (click)="onHome()"
            >
              <span style="gap: 0.5rem">  <i class="pi pi-home"></i>  Voltar ao Início</span>
            </button>
          </div>
        </div>

        <div class="action-section">
          <h4>Conta</h4>
          <div class="action-buttons">
            <button
              type="button"
              class="custom-header-button"
              (click)="onLogout()"
            >
              <span style="gap: 0.5rem"> <i class="pi pi-sign-out"></i>  Fazer Logout</span>
            </button>
            <button
              type="button"
              class="custom-header-button"
              (click)="onDeleteAccount()"
            >
              <span style="gap: 0.5rem"> <i class="pi pi-trash"></i>  Deletar Conta</span>
            </button>
          </div>
        </div>
      </div>
    </p-card>

  </div>

  <!-- Modal de Edição -->
  <p-dialog
    [visible]="isEditModalVisible()"
    (visibleChange)="isEditModalVisible.set($event)"
    [modal]="true"
    [closable]="true"
    [resizable]="false"
    [draggable]="false"
    styleClass="edit-profile-dialog">

    <ng-template pTemplate="header" >
      <div class="dialog-header-content">
        <i class="pi pi-user-edit"></i>
        <span>Editar Perfil</span>
      </div>
    </ng-template>

    <form [formGroup]="editForm" (ngSubmit)="onSaveProfile()">

      <!-- Campo Username -->
      <div class="form-group">
        <label for="username">Nome de Usuário *</label>
        <p-inputGroup>
          <p-inputGroupAddon>
            <i class="pi pi-user"></i>
          </p-inputGroupAddon>
          <input
            pInputText
            id="username"
            formControlName="username"
            placeholder="Seu nome de usuário"
            [class.p-invalid]="editForm.get('username')?.touched && editForm.get('username')?.errors">
        </p-inputGroup>
        <small class="p-error" *ngIf="usernameErrors">{{ usernameErrors }}</small>
      </div>

      <!-- Campo Email -->
      <div class="form-group">
        <label for="email">Email *</label>
        <p-inputGroup>
          <p-inputGroupAddon>
            <i class="pi pi-envelope"></i>
          </p-inputGroupAddon>
          <input
            pInputText
            id="email"
            formControlName="email"
            placeholder="seu@email.com"
            [class.p-invalid]="editForm.get('email')?.touched && editForm.get('email')?.errors">
        </p-inputGroup>
        <small class="p-error" *ngIf="emailErrors">{{ emailErrors }}</small>
      </div>

      <!-- Campo Password -->
      <div class="form-group">
        <label for="password">Nova Senha (opcional)</label>
        <p-inputGroup>
          <p-inputGroupAddon>
            <i class="pi pi-lock"></i>
          </p-inputGroupAddon>
          <input
            pInputText
            type="password"
            id="password"
            formControlName="password"
            placeholder="Deixe em branco para manter a atual"
            [class.p-invalid]="editForm.get('password')?.touched && editForm.get('password')?.errors">
        </p-inputGroup>
        <small class="p-error" *ngIf="passwordErrors">{{ passwordErrors }}</small>
      </div>

      <!-- Botões do Modal -->
      <div class="modal-actions">
        <p-button
          label="Cancelar"
          icon="pi pi-times"
          class="p-button-secondary"
          type="button"
          (click)="onCancelEdit()">
        </p-button>
        <p-button
          label="Salvar Alterações"
          icon="pi pi-check"
          class="p-button-primary"
          type="submit"
          [loading]="isLoading()">
        </p-button>
      </div>

    </form>

  </p-dialog>

</div>
