<div class="dashboard-container">
  <!-- Toast para notifica√ß√µes -->
  <p-toast position="top-right"></p-toast>

  <!-- Dialog de confirma√ß√£o -->
  <p-confirmDialog></p-confirmDialog>

  <!-- Header do Dashboard -->
  <div class="dashboard-header">
    <div class="user-profile-header">
      <app-user-avatar
        [username]="currentUser()?.username || ''"
        [clickable]="false"
        size="extra-large">
      </app-user-avatar>
      <div class="user-info-header">
        <h1>{{ currentUser()?.username }}</h1>
        <p>{{ currentUser()?.email }}</p>
      </div>
    </div>
  </div>

  <!-- Cards do Dashboard -->
  <div class="dashboard-grid">

    <!-- Card de Informa√ß√µes Pessoais -->
    <p-card header="üë§ Informa√ß√µes Pessoais" class="info-card">
      <div class="user-details">
        <div class="detail-row">
          <label>ID:</label>
          <span>{{ currentUser()?.id }}</span>
        </div>
        <div class="detail-row">
          <label>Nome de Usu√°rio:</label>
          <span>{{ currentUser()?.username }}</span>
        </div>
        <div class="detail-row">
          <label>Email:</label>
          <span>{{ currentUser()?.email }}</span>
        </div>
        <div class="detail-row">
          <label>Status da Conta:</label>
          <span class="status-active">‚úÖ Ativa</span>
        </div>
      </div>

      <div class="card-actions">
        <p-button
          label="Editar Perfil"
          icon="pi pi-user-edit"
          class="p-button-primary edit-btn"
          (click)="onEditProfile()">
        </p-button>
      </div>
    </p-card>

    <!-- Card de Autentica√ß√£o -->
    <p-card header="üîê Status de Autentica√ß√£o" class="auth-card">
      <div class="auth-info">
        <div class="auth-status">
          <i class="pi pi-check-circle success-icon"></i>
          <div>
            <h3>Autenticado com Sucesso</h3>
            <p>Voc√™ est√° logado e pode acessar todas as funcionalidades.</p>
          </div>
        </div>

        <div class="security-features">
          <h4>Recursos de Seguran√ßa:</h4>
          <ul>
            <li>‚úì Token de autentica√ß√£o v√°lido</li>
            <li>‚úì Sess√£o segura ativa</li>
            <li>‚úì Auth Guard funcionando</li>
            <li>‚úì Acesso a rotas protegidas</li>
          </ul>
        </div>
      </div>
    </p-card>

    <!-- Card de A√ß√µes da Conta -->
    <p-card header="‚öôÔ∏è Gerenciar Conta" class="actions-card">
      <div class="account-actions">
        <div class="action-section">
          <h4>Navega√ß√£o</h4>
          <div class="action-buttons">
            <p-button
              label="Criar Jogador"
              icon="pi pi-user-plus"
              class="p-button-secondary"
              routerLink="/player-selection">
            </p-button>
            <p-button
              label="Voltar ao In√≠cio"
              icon="pi pi-home"
              class="p-button-info"
              routerLink="/home">
            </p-button>
          </div>
        </div>

        <div class="action-section">
          <h4>Conta</h4>
          <div class="action-buttons">
            <p-button
              label="Fazer Logout"
              icon="pi pi-sign-out"
              class="p-button-warning logout-btn"
              (click)="onLogout()">
            </p-button>
            <p-button
              label="Deletar Conta"
              icon="pi pi-trash"
              class="p-button-danger delete-btn"
              (click)="onDeleteAccount()">
            </p-button>
          </div>
        </div>
      </div>
    </p-card>

  </div>

  <!-- Modal de Edi√ß√£o -->
  <p-dialog
    header="‚úèÔ∏è Editar Perfil"
    [visible]="isEditModalVisible()"
    (visibleChange)="isEditModalVisible.set($event)"
    [modal]="true"
    [closable]="true"
    [resizable]="false"
    [draggable]="false"
    styleClass="edit-profile-dialog">

    <form [formGroup]="editForm" (ngSubmit)="onSaveProfile()">

      <!-- Campo Username -->
      <div class="form-group">
        <label for="username">Nome de Usu√°rio *</label>
        <p-inputGroup>
          <p-inputGroupAddon>
            <i class="pi pi-user"></i>
          </p-inputGroupAddon>
          <input
            pInputText
            id="username"
            formControlName="username"
            placeholder="Seu nome de usu√°rio"
            [class.p-invalid]="editForm.get('username')?.touched && editForm.get('username')?.errors">
        </p-inputGroup>
        <small class="p-error" *ngIf="usernameErrors">{{ usernameErrors }}</small>
      </div>

      <!-- Campo Email -->
      <div class="form-group">
        <label for="email">Email *</label>
        <p-inputGroup>
          <p-inputGroupAddon>
            <i class="pi pi-envelope"></i>
          </p-inputGroupAddon>
          <input
            pInputText
            id="email"
            formControlName="email"
            placeholder="seu@email.com"
            [class.p-invalid]="editForm.get('email')?.touched && editForm.get('email')?.errors">
        </p-inputGroup>
        <small class="p-error" *ngIf="emailErrors">{{ emailErrors }}</small>
      </div>

      <!-- Campo Password -->
      <div class="form-group">
        <label for="password">Nova Senha (opcional)</label>
        <p-inputGroup>
          <p-inputGroupAddon>
            <i class="pi pi-lock"></i>
          </p-inputGroupAddon>
          <input
            pInputText
            type="password"
            id="password"
            formControlName="password"
            placeholder="Deixe em branco para manter a atual"
            [class.p-invalid]="editForm.get('password')?.touched && editForm.get('password')?.errors">
        </p-inputGroup>
        <small class="p-error" *ngIf="passwordErrors">{{ passwordErrors }}</small>
      </div>

      <!-- Bot√µes do Modal -->
      <div class="modal-actions">
        <p-button
          label="Cancelar"
          icon="pi pi-times"
          class="p-button-secondary"
          type="button"
          (click)="onCancelEdit()">
        </p-button>
        <p-button
          label="Salvar Altera√ß√µes"
          icon="pi pi-check"
          class="p-button-primary"
          type="submit"
          [loading]="isLoading()">
        </p-button>
      </div>

    </form>

  </p-dialog>

</div>
